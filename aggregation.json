[{"created":"20230402014525104","title":"$:/aggregation/macros","tags":"$:/tags/Macro $:/tags/Macro/Aggregation $:/tags/XpPreview","text":"\\define aggregation(filter,state:\"aggregation-state\", defaultFields:\"tbl-expand title\",class:\"w-100\",paginationButton:\"yes\",rowsButton:\"no\",viewButton:\"yes\",tiddler, searchClass:\"xp-search-aggregation\", cardTemplate:\"$:/aggregation-card-template\", tocTemplate, promptTiddler:\"$:/aggregation/prompt\")\n\\import $:/aggregation/macros/definitions\n\\whitespace trim\n<$list filter=\"\"\"$filter$ +[limit[1]]\"\"\" emptyMessage=\"{{$promptTiddler$}}\" variable=\"ignore\">\n<span class=\"xp-search $searchClass$\">\nSearch &#32;\n<$select\n  tiddler=\"\"\"$:/config/xp/$state$/SearchScope\"\"\"\n  default=\"+[search<userInput>]\"\n  tooltip=\"Choosing the Search Scope\"\n  class=\"xp-aggregation-select\">\n  <option value=\"+[search:*<userInput>]\"> all fields</option>\n  <option value=\"+[search:*:literal,casesensitive<userInput>]\"> all exact match</option>\n  <option value=\"+[search:-text,*<userInput>]\"> all except text</option>\n  <option value=\"+[search<userInput>]\"> title text tags</option>\n  <option value=\"+[search:title,caption<userInput>]\"> title caption</option>\n</$select>\n<i class='tc-small-gap-left'/>\n<$macrocall\n  $name=\"keyboard-driven-input\"\n  tiddler=\"\"\"$:/temp/search/$state$\"\"\"\n  type=\"search\"\n  tag=\"input\"\n  focus={{$:/config/xp/aggregation/SearchAutoFocus}}\n  inputCancelActions=\"\"\"<$action-deletetiddler $filter=\"[[$:/state/filter/$state$]get[checktiddler]enlist-input[]]\"/><$action-deletetiddler $filter=\"$:/temp/search/$state$ $:/state/filter/$state$ $:/temp/xp/$state$/Field $:/temp/xp/$state$/Date $:/temp/xp/$state$/FieldValue\"/>\"\"\"\n/>\n</span>\n<i class='tc-tiny-gap-left'/>\n<$let userInput={{{ [[$:/temp/search/$state$]get[text]] }}}\n    searchRun={{{ [[$:/config/xp/$state$/SearchScope]has[text]get[text]] ~\"+[search<userInput>]\" }}}\n    timeRun={{{ [[$:/state/filter/$state$]get[filter]] }}}\n    sortRun={{{ [[$:/temp/xp/$state$/Sorting]is[tiddler]get[text]] }}}\n    fieldRun={{{ [[$:/temp/xp/$state$/Field]has[filter]get[filter]] }}}\n    valueRun={{{ [[$:/temp/xp/$state$/FieldValue]has[filter]get[filter]] }}}\n    resultCount=\"<$count filter=<<searchFilter>>/>\"\n    sortState={{{ [[$:/state/dynamictables/$state$/sortby]has[title]] ~$:/temp/xp/$state$/Sorting }}}\n    tempTableSort=\"\"\"$:/state/dynamictables/$state$/sortby\"\"\"\n    sortIndex={{{ [[$:/state/dynamictables/$state$/sortby]getindex[sortIndex]] }}}\n    storeTitle=\"\"\"$:/temp/search/$state$\"\"\"\n    filterState=\"\"\"$:/state/filter/$state$\"\"\"\n    fieldTiddler=\"\"\"$:/temp/xp/$state$/Field\"\"\"\n    dateTiddler=\"\"\"$:/temp/xp/$state$/Date\"\"\"\n    valueTiddler=\"\"\"$:/temp/xp/$state$/FieldValue\"\"\"\n    sortTiddler=\"\"\"$:/temp/xp/$state$/Sorting\"\"\"\n    defaultView=\"\"\"$:/config/xp/$state$/DefaultView\"\"\"\n    readingMode=\"\"\"$:/config/xp/$state$/ReadingMode\"\"\"\n    sourceMode=\"\"\"$:/config/xp/$state$/SourceMode\"\"\"\n    tocSwitchTid=\"\"\"$:/temp/xp/$state$/aggregation-toc\"\"\"\n    config-base=\"\"\"$:/config/xp/$state$/TableFields/Visibility/\"\"\"\n    navTiddler={{{ [<__tiddler__>has[title]] ~[<currentTiddler>] }}}>\n<span class=\"tc-search\">\n<$reveal state=<<filterState>> type=\"nomatch\" text=\"yes\">\n<$button set=<<filterState>> setTo=\"yes\" class=\"tc-btn-invisible\">\n{{$:/xp/images/filter}}\n</$button>\n</$reveal>\n<$set name=\"stateTiddler\" filter=\"[<storeTitle>!is[missing]has[text]]\" value=<<storeTitle>> emptyValue=<<filterState>>>\n<$reveal state=<<stateTiddler>> type=\"nomatch\" text=\"\">\n<$button class=\"tc-btn-invisible\">\n<$action-deletetiddler $filter=\"[[$:/state/filter/$state$]get[checktiddler]enlist-input[]]\"/>\n<$action-deletetiddler $filter=\"$:/temp/search/$state$ $:/state/filter/$state$ $:/temp/xp/$state$/Field $:/temp/xp/$state$/Date $:/temp/xp/$state$/FieldValue\"/>\n<$action-sendmessage $message=\"tm-focus-selector\" $param=\"\"\".$searchClass$ input\"\"\"/>\n{{$:/core/images/close-button}}\n</$button>\n</$reveal>\n</$set>\n<$list filter=\"[<__viewButton__>match[yes]]\" variable=\"ignore\">\n<$reveal state=<<readingMode>> type=\"nomatch\" text=\"on\">\n<<toggleViewButton>>\n</$reveal>\n</$list>\n<<sortingButton>>\n<<toggleReadingMode>>\n<<viewSource>>\n<<tocSwitch>>\n</span>\n<$wikify text=<<target-filter-code>> name=\"targetFilter\">\n<$set name=\"searchFilter\" filter=\"[<filterState>has[list]]\" value=<<targetFilter>> emptyValue={{{ [<__filter__>addsuffix[ ]addsuffix<searchRun>addsuffix<timeRun>addsuffix<fieldRun>addsuffix<valueRun>addsuffix<sortRun>] }}}>\n<$set name=\"stateTiddler\" filter=\"[<storeTitle>!is[missing]get[text]!is[blank]]\" value=<<storeTitle>> emptyValue=<<filterState>>>\n<$reveal state=<<stateTiddler>> type=\"nomatch\" text=\"\">\n<$reveal state=<<filterState>> type=\"nomatch\" text=\"yes\" animate=\"yes\">\n<span class=\"xp-search-results\"><<lingo System/Matches>></span>\n</$reveal>\n</$reveal>\n<$reveal state=<<filterState>> type=\"nomatch\" text=\"yes\" animate=\"yes\">\n<<unsortButton>>\n</$reveal>\n</$set>\n<$reveal state=<<filterState>> type=\"match\" text=\"yes\" animate=\"yes\">\n<div class=\"xp-wrapper-aggrfilter\">\n\nFiltered by Tag: <<deselectButton>>\n\n<div class=\"xp-aggrfilter-category\">\n<table>\n<tbody>\n<$list filter=\"\"\"$filter$ +[tags[]!is[system]limit[1]]\"\"\" variable=\"ignore\">\n<tr>\n<td><span class=\"xp-aggrfilter-category-title tc-muted\">Tags</span></td>\n<td>\n<span class=\"xp-aggrfilter-category-item\">\n<$list filter=\"\"\"$filter$ +[tags[]!is[system]sort[]]\"\"\" variable=\"currentItem\">\n<$macrocall $name=\"aggrfilteritem\" item=<<currentItem>>/>\n</$list>\n</span>\n</td>\n</tr>\n</$list>\n<$list filter=\"\"\"$filter$ +[tags[]is[system]limit[1]]\"\"\" variable=\"ignore\">\n<tr>\n<td><span class=\"xp-aggrfilter-category-title tc-muted\">$Tags</span></td>\n<td>\n<span class=\"xp-aggrfilter-category-item\">\n<$list filter=\"\"\"$filter$ +[tags[]is[system]sort[]]\"\"\" variable=\"currentItem\">\n<$macrocall $name=\"aggrfilteritem\" item=<<currentItem>>/>\n</$list>\n</span>\n</td>\n</tr>\n</$list>\n</tbody>\n</table>\n</div>\n\nFiltered by Time / Field: <<resetFieldButton>>\n\n<div class=\"xp-aggrfilter-category\">\n<table>\n<tbody>\n<tr>\n<td>\n<span class=\"xp-aggrfilter-category-title tc-muted\">Time</span>&#32;\n<$select\n  tiddler=<<filterState>>\n  field=\"filter\"\n  class=\"xp-aggregation-select\"\n  actions=\"<$list filter='[<filterState>search:filter[regexp:created]]'><$action-setfield $tiddler=<<dateTiddler>> status='show'/></$list>\">\n  <option value=\"\"> All</option>\n  <option value=\"+[days:created[-1]]\"> Past 24 hours</option>\n  <option value=\"+[days:created[-7]]\"> Past week</option>\n  <option value=\"+[days:created[-30]]\"> Past month</option>\n  <option value=\"+[days:created[-365]]\"> Past year</option>\n  <option value=\"+[regexp:created[]]\"> Enter a date</option>\n</$select>\n</td>\n<$list filter=\"[<dateTiddler>is[tiddler]]\">\n<td>\n<span class=\"xp-aggrfilter-category-title tc-muted\">Date</span>&#32;\n<$vars pt=\" +[regexp:created[^\" st=\"]]\">\n<$macrocall\n  $name=\"keyboard-driven-input\" \n  tiddler=<<dateTiddler>>\n  type=\"search\"\n  tag=\"input\"\n  size=7\n  focus=\"no\"\n  inputCancelActions=<<input-cancel-actions-date>>\n  inputAcceptActions=<<input-accept-actions-date>>\n/>\n&#32;\n<$button> Enter\n<<input-accept-actions-date>>\n</$button>\n</$vars>\n</td>\n</$list>\n<$vars\n    getField={{{ [<fieldTiddler>is[tiddler]get[text]] }}}\n    getValue={{{ [<valueTiddler>is[tiddler]get[text]] }}}\n    pt1=\"+[has:field[\"\n    pt2=\"+[\"\n    st=\"]]\"\n    st2=\"[\"\n    >\n<td>\n<span class=\"xp-aggrfilter-category-title tc-muted\"> Field </span>&#32;\n<$select\n  tiddler=<<fieldTiddler>>\n  tooltip=\"Choosing the Field\"\n  class=\"xp-aggregation-select\"\n  actions=\"<$action-setfield $tiddler=<<fieldTiddler>> filter={{{ [<fieldTiddler>get[text]addprefix<pt1>addsuffix<st>] }}}/><$action-deletetiddler $tiddler=<<valueTiddler>>/>\">\n  <$list filter=\"\"\"$filter$ +[fields:exclude{$:/config/xp/aggregation/excluded-fields/filtering-button}]\"\"\">\n  <option><$view field=\"title\"/></option>\n  </$list>\n</$select>\n</td>\n<$list\n  filter=\"\"\"$filter$ +[has<getField>limit[1]]\"\"\"\n  emptyMessage=\"<$list filter='[<fieldTiddler>has[text]]'><td><span class='xp-aggrfilter-category-title tc-muted'> No value for this field </span></td></$list>\"\n  variable=\"ignore\">\n<td>\n<span class=\"xp-aggrfilter-category-title tc-muted\"> Value </span>&#32;\n<$select\n  tiddler=<<valueTiddler>>\n  tooltip=\"Choosing the Value\"\n  class=\"xp-aggregation-select\"\n  actions=\"\"\"<$action-setfield $tiddler=<<valueTiddler>> filter={{{ [<getField>addprefix<pt2>addsuffix<st2>addsuffix{$:/temp/xp/$state$/FieldValue}addsuffix<st>] }}}/>\"\"\">\n  <$list filter=\"\"\"$filter$ +[has<getField>each<getField>get<getField>!is[blank]]\"\"\">\n  <option><$view field=\"title\"/></option>\n  </$list>\n</$select>\n</td>\n</$list>\n</$vars>\n</tr>\n</tbody>\n</table>\n</div>\n\n</div>\n</$reveal>\n<$reveal state=<<filterState>> type=\"match\" text=\"yes\" animate=\"yes\">\n<<lingo System/Matches>>\n<<unsortButton>>\n</$reveal>\n\n<$reveal state=<<readingMode>> type=\"nomatch\" text=\"on\" animate=\"yes\">\n\n<!-- Show table -->\n<$reveal state=<<defaultView>> default=\"table\" type=\"match\" text=\"table\" animate=\"yes\">\n<$wikify name=\"dtableFields\" text=\"\"\"<$list filter=\"[list[$:/config/xp/$state$/TableFields]]\" variable=\"listField\"><$reveal type=\"match\" state=<<field-config-title>> text=\"show\"> <$text text={{{ [<listField>format:titlelist[]] }}}/> </$reveal></$list>\"\"\">\n<$set name=\"fields\" filter=\"[<dtableFields>is[blank]]\" value=<<__defaultFields__>> emptyValue=<<dtableFields>>>\n<$macrocall \n  $name=\"aggregation-dtable\"\n  filter=<<searchFilter>>\n  fields=<<fields>>\n  class=<<__class__>>\n  stateTiddler=<<__state__>>\n  paginationButton=<<__paginationButton__>>\n  rowsButton=<<__rowsButton__>>\n/>\n</$set>\n</$wikify>\n</$reveal>\n\n<!-- Show card -->\n<$reveal state=<<defaultView>> default=\"table\" type=\"nomatch\" text=\"table\" animate=\"yes\">\n<div class=\"content\" style=\"padding-top:10px;\">\n<$list\n  filter=<<searchFilter>>\n  template=<<__cardTemplate__>>\n/>\n</div>\n</$reveal>\n\n</$reveal>\n\n<!-- Reading Mode -->\n<$reveal state=<<readingMode>> type=\"match\" text=\"on\" animate=\"yes\">\n<$list filter=\"\"\"$filter$ +[limit[1]]\"\"\" variable=\"ignore\">\n<$vars selectedTiddler=\"$:/temp/toc/selectedTiddler/$state$\" template=\"\" exclude=\"\">\n\n<div style=\"padding:10px 0;\">\n<$tiddler tiddler={{{ [<selectedTiddler>get[text]] }}}>\n<div class=\"tc-tabbed-table-of-contents\" style=\"\">\n<$list filter=\"[<tocSwitchTid>!text[hide]]\" variable=\"ignore\">\n    <$linkcatcher to=<<selectedTiddler>>>\n    <div class=\"tc-table-of-contents xp-aggregation-toc\">\n    <$set name=\"excluded\" filter=\"[enlist<exclude>]\">\n        <ol class=\"tc-toc toc-selective-expandable\">\n        <$list filter=\"[subfilter<searchFilter>] -[enlist<exclude>]\">\n<$macrocall $name=\"toc-linked-selective-expandable-body\" itemClassFilter=\"[all[current]] -[<selectedTiddler>get[text]]\" exclude=<<excluded>>/>\n        </$list>\n        </ol>\n    </$set>\n    </div>\n    </$linkcatcher>\n</$list>\n    <div class=\"tc-tabbed-table-of-contents-content\">\n    <$reveal stateTitle=<<selectedTiddler>> type=\"nomatch\" text=\"\">\n        <$transclude mode=\"block\" tiddler=<<template>>>\n<$reveal state=<<sourceMode>> type=\"nomatch\" text=\"on\">\n    <h1><$link><$transclude field=\"caption\"><$view field=\"title\"/></$transclude></$link>&emsp;<span class=\"tc-tiddler-controls\" style=\"font-size:0.73em !important;\"><$list filter=\"$:/core/ui/Buttons/new-here $:/core/ui/Buttons/clone $:/core/ui/Buttons/delete $:/core/ui/Buttons/edit\" variable=\"listItem\"><$set name=\"tv-config-toolbar-class\" filter=\"[<tv-config-toolbar-class>] [<listItem>encodeuricomponent[]addprefix[tc-btn-]]\"><$transclude tiddler=<<listItem>>/></$set></$list></span></h1>\n    ^^<i class=\"tc-muted\"><$view field=\"modified\" format=\"date\" template=\"DDth MMM YYYY at 0hh:0mm\">TBA</$view></i>^^\n    <$transclude mode=\"block\"><p>Missing tiddler.</p></$transclude>\n</$reveal>\n<!-- Source Mode -->\n<$reveal state=<<sourceMode>> type=\"match\" text=\"on\">\n    <h1><$link><$view field=\"title\"/></$link>&emsp;<span class=\"tc-tiddler-controls\" style=\"font-size:0.73em !important;\"><$list filter=\"$:/core/ui/Buttons/new-here $:/core/ui/Buttons/clone $:/core/ui/Buttons/delete $:/core/ui/Buttons/edit\" variable=\"listItem\"><$set name=\"tv-config-toolbar-class\" filter=\"[<tv-config-toolbar-class>] [<listItem>encodeuricomponent[]addprefix[tc-btn-]]\"><$transclude tiddler=<<listItem>>/></$set></$list></span></h1>\n    ^^<i class=\"tc-muted\"><$view field=\"modified\" format=\"date\" template=\"DDth MMM YYYY at 0hh:0mm\">TBA</$view></i>^^\n    <$codeblock code={{{ [<currentTiddler>get[text]] }}}><p>Missing tiddler.</p></$codeblock>\n</$reveal>\n        </$transclude>\n<!-- Navigation -->\n<div class=\"xp-aggregation-toc-navigation\">\n    <$list filter=\"[subfilter<searchFilter>] -[enlist<exclude>] +[after<currentTiddler>]\" variable=\"nextTiddler\">\n    <$linkcatcher to=<<selectedTiddler>> actions=\"<$action-navigate $to=<<navTiddler>> $scroll='yes'/>\">\n        ''NEXT''\n        <div><$link to=<<nextTiddler>>><$text text=<<nextTiddler>>/></$link></div>\n    </$linkcatcher>\n    </$list>\n    <$list filter=\"[subfilter<searchFilter>] -[enlist<exclude>] +[before<currentTiddler>]\" variable=\"prevTiddler\">\n    <$linkcatcher to=<<selectedTiddler>> actions=\"<$action-navigate $to=<<navTiddler>> $scroll='yes'/>\">\n        <div style=\"padding-top:7px;\">\n        ''PREVIOUS''\n        <div><$link to=<<prevTiddler>>><$text text=<<prevTiddler>>/></$link></div>\n        </div>\n    </$linkcatcher>\n    </$list>\n</div>\n    </$reveal>\n    <$reveal stateTitle=<<selectedTiddler>> type=\"match\" text=\"\">\n        <p>Select a topic in the table of contents. Click the arrow to expand a topic.</p>\n    </$reveal>\n    </div>\n</div>\n</$tiddler>\n</div>\n\n</$vars>\n</$list>\n</$reveal>\n\n</$set>\n</$wikify>\n</$let>\n</$list>\n\\end\n\n\n\\define aggregation-filtersearch(fields:\"tbl-expand title\", class:\"w-100\", state:\"aggregation-general\", paginationButton:\"yes\", rowsButton:\"no\", viewButton:\"yes\", searchClass:\"xp-search-aggregation\", cardTemplate:\"$:/aggregation-card-template\", tocTemplate, promptTiddler:\"$:/aggregation/prompt\")\n\\import $:/aggregation/macros/general\n\\whitespace trim\n<$list filter=<<aggr-has-tids>> emptyMessage=\"{{$promptTiddler$}}\" variable=\"ignore\">\n<span class=\"xp-search $searchClass$\">\nSearch &#32; <<selectSearchScope>> <i class='tc-small-gap-right'/> <$macrocall $name=\"keyboard-driven-input\"\n    tiddler=\"\"\"$:/temp/search/$state$\"\"\"\n    type=\"search\"\n    tag=\"input\"\n    focus={{$:/config/xp/aggregation/SearchAutoFocus}}\n    inputCancelActions=\"\"\"<$action-deletetiddler $filter=\"[[$:/state/filter/$state$]get[checktiddler]enlist-input[]]\"/><$action-deletetiddler $filter=\"$:/temp/search/$state$ $:/state/filter/$state$ $:/temp/xp/$state$/Field $:/temp/xp/$state$/Date $:/temp/xp/$state$/FieldValue\"/>\"\"\"/>\n</span>\n<i class='tc-tiny-gap-left'/>\n<$vars userInput={{{ [[$:/temp/search/$state$]get[text]] }}}\n    timeRun={{{ [[$:/state/filter/$state$]get[filter]] }}}\n    sortRun={{{ [[$:/temp/xp/$state$/Sorting]is[tiddler]get[text]] }}}\n    fieldRun={{{ [[$:/temp/xp/$state$/Field]has[filter]get[filter]] }}}\n    valueRun={{{ [[$:/temp/xp/$state$/FieldValue]has[filter]get[filter]] }}}\n    resultCount=\"<$count filter=<<searchFilter>>/>\"\n    sortState={{{ [[$:/state/dynamictables/$state$/sortby]is[tiddler]] ~$:/temp/xp/$state$/Sorting }}}\n    tempTableSort=\"\"\"$:/state/dynamictables/$state$/sortby\"\"\"\n    sortIndex={{{ [[$:/state/dynamictables/$state$/sortby]getindex[sortIndex]] }}}\n    categoryPrefix=\"\"\"$:/config/xp/$state$/category/\"\"\"\n    storeTitle=\"\"\"$:/temp/search/$state$\"\"\"\n    filterState=\"\"\"$:/state/filter/$state$\"\"\"\n    fieldTiddler=\"\"\"$:/temp/xp/$state$/Field\"\"\"\n    dateTiddler=\"\"\"$:/temp/xp/$state$/Date\"\"\"\n    valueTiddler=\"\"\"$:/temp/xp/$state$/FieldValue\"\"\"\n    sortTiddler=\"\"\"$:/temp/xp/$state$/Sorting\"\"\"\n    defaultView=\"\"\"$:/config/xp/$state$/DefaultView\"\"\"\n    readingMode=\"\"\"$:/config/xp/$state$/ReadingMode\"\"\"\n    sourceMode=\"\"\"$:/config/xp/$state$/SourceMode\"\"\"\n    tocSwitchTid=\"\"\"$:/temp/xp/$state$/aggregation-toc\"\"\"\n    config-base=\"\"\"$:/config/xp/$state$/TableFields/Visibility/\"\"\">\n<span class=\"tc-search\">\n<$reveal state=<<filterState>> type=\"nomatch\" text=\"yes\">\n<$button class=\"tc-btn-invisible\">\n<$action-setfield $tiddler=<<filterState>> text=\"yes\"/>\n{{$:/xp/images/filter}}\n</$button>\n</$reveal>\n<$set name=\"stateTiddler\" filter=\"[<storeTitle>!is[missing]has[text]]\" value=<<storeTitle>> emptyValue=<<filterState>>>\n<$reveal state=<<stateTiddler>> type=\"nomatch\" text=\"\">\n<$button class=\"tc-btn-invisible\">\n<$action-deletetiddler $filter=\"[[$:/state/filter/$state$]get[checktiddler]enlist-input[]]\"/><$action-deletetiddler $filter=\"$:/temp/search/$state$ $:/state/filter/$state$ $:/temp/xp/$state$/Field $:/temp/xp/$state$/Date $:/temp/xp/$state$/FieldValue\"/>\n<$action-sendmessage $message=\"tm-focus-selector\" $param=\"\"\".$searchClass$ input\"\"\"/>\n{{$:/core/images/close-button}}\n</$button>\n</$reveal>\n</$set>\n<$list filter=\"[<__viewButton__>match[yes]]\" variable=\"ignore\">\n<$reveal state=<<readingMode>> type=\"nomatch\" text=\"on\">\n<<toggleViewButton>>\n</$reveal>\n</$list>\n<<sortingButton>>\n<<toggleReadingMode>>\n<<viewSource>>\n<<tocSwitch>>\n</span>\n<$wikify text=<<alltagsfilter>> name=\"alltagsfilterwikified\">\n<$set name=\"searchFilter\" filter=\"[<filterState>has[list]]\" value=<<alltagsfilterwikified>> emptyValue={{{ [<configTiddler>get[text]addsuffix<timeRun>addsuffix<fieldRun>addsuffix<valueRun>addsuffix<sortRun>] }}}>\n<$set name=\"stateTiddler\" filter=\"[<storeTitle>!is[missing]get[text]!is[blank]]\" value=<<storeTitle>> emptyValue=<<filterState>>>\n<$reveal state=<<stateTiddler>> type=\"nomatch\" text=\"\">\n<$reveal state=<<filterState>> type=\"nomatch\" text=\"yes\" animate=\"yes\">\n<span class=\"xp-search-results\"><<lingo System/Matches>></span>\n</$reveal>\n</$reveal>\n<$reveal state=<<filterState>> type=\"nomatch\" text=\"yes\" animate=\"yes\">\n<<unsortButton>>\n</$reveal>\n</$set>\n<$reveal state=<<filterState>> type=\"match\" text=\"yes\" animate=\"yes\">\n<div class=\"xp-wrapper-aggrfilter\">\n\n<<filtered-by-tag>>\n\nFiltered by Time / Field: <<resetFieldButton>>\n\n<div class=\"xp-aggrfilter-category\">\n<table>\n<tbody>\n<tr>\n<<filtered-by-time>>\n<$vars getField={{{ [<fieldTiddler>is[tiddler]get[text]] }}} getValue={{{ [<valueTiddler>is[tiddler]get[text]] }}}\n    pt1=\"+[has:field[\" pt2=\"+[\" st=\"]]\" st2=\"[\">\n<td>\n<span class=\"xp-aggrfilter-category-title tc-muted\"> Field </span>&#32;\n<$select tiddler=<<fieldTiddler>> tooltip=\"Choosing the Field\" class=\"xp-aggregation-select\" actions=\"\"\"<$action-setfield $tiddler=<<fieldTiddler>> filter={{{ [<fieldTiddler>get[text]addprefix<pt1>addsuffix<st>] }}}/><$action-deletetiddler $tiddler=<<valueTiddler>>/>\"\"\">\n<$list filter=\"[tag<aggregationTag>fields:exclude{$:/config/xp/aggregation/excluded-fields/filtering-button}]\">\n<option><$view field=\"title\"/></option>\n</$list>\n</$select>\n</td>\n<$list filter=\"[tag<aggregationTag>has{$:/temp/xp/$state$/Field}limit[1]]\" emptyMessage=\"\"\"<$list filter=\"[<fieldTiddler>has[text]]\"><td><span class=\"xp-aggrfilter-category-title tc-muted\"> No value for this field </span></td></$list>\"\"\" variable=\"ignore\">\n<td>\n<span class=\"xp-aggrfilter-category-title tc-muted\"> Value </span>&#32;\n<$select tiddler=<<valueTiddler>> tooltip=\"Choosing the Value\" class=\"xp-aggregation-select\" actions=\"\"\"<$action-setfield $tiddler=<<valueTiddler>> filter={{{ [<getField>addprefix<pt2>addsuffix<st2>addsuffix{$:/temp/xp/$state$/FieldValue}addsuffix<st>] }}}/>\"\"\">\n<$list filter=\"[tag<aggregationTag>has<getField>each<getField>get<getField>!is[blank]]\">\n<option><$view field=\"title\"/></option>\n</$list>\n</$select>\n</td>\n</$list>\n</$vars>\n</tr>\n</tbody>\n</table>\n</div>\n\n</div>\n</$reveal>\n<$reveal state=<<filterState>> type=\"match\" text=\"yes\" animate=\"yes\">\n<<lingo System/Matches>>\n<<unsortButton>>\n</$reveal>\n\n<$reveal state=<<readingMode>> type=\"nomatch\" text=\"on\" animate=\"yes\">\n\n<!-- Show table -->\n<$reveal state=<<defaultView>> default=\"table\" type=\"match\" text=\"table\" animate=\"yes\">\n<$macrocall \n  $name=\"aggr-table\"\n  filter=<<searchFilter>>\n  fields=<<__fields__>>\n  class=<<__class__>>\n  stateTiddler=<<__state__>>\n  paginationButton=<<__paginationButton__>>\n  rowsButton=<<__rowsButton__>>\n/>\n</$reveal>\n\n<!-- Show card -->\n<$reveal state=<<defaultView>> default=\"table\" type=\"nomatch\" text=\"table\" animate=\"yes\">\n<div class=\"content\" style=\"padding-top:10px;\">\n<$list\n  filter=<<searchFilter>>\n  template=<<__cardTemplate__>>\n/>\n</div>\n</$reveal>\n\n</$reveal>\n\n<!-- Reading Mode -->\n<$reveal state=<<readingMode>> type=\"match\" text=\"on\" animate=\"yes\">\n<$list filter=\"[subfilter<searchFilter>limit[1]]\" variable=\"ignore\">\n\n<$macrocall\n  $name=\"aggregation-toc\"\n  filter=<<searchFilter>>\n  selectedTiddler=\"\"\"$:/temp/toc/selectedTiddler/$state$\"\"\"\n  template=<<__tocTemplate__>>\n  sourceMode=<<sourceMode>>\n  tocSwitchTid=<<tocSwitchTid>>\n/>\n\n</$list>\n</$reveal>\n\n</$set>\n</$wikify>\n</$vars>\n</$list>\n\\end\n\n\n\\define aggregation-table-dynamic(fields:\"tbl-expand title tags\",class:\"w-100\",state:\"aggregation\",storeTitle:\"$:/temp/search/aggregation/dtable\",searchClass:\"xp-search-aggregation\",promptTiddler:\"$:/aggregation/prompt\")\n\\import $:/aggregation/macros/general\n\\whitespace trim\n<$list filter=<<aggr-has-tids>> emptyMessage=\"{{$promptTiddler$}}\" variable=\"ignore\">\n<span class=\"xp-search $searchClass$\">\nSearch &#32; <<selectSearchScope>> <i class='tc-small-gap-right'/> <$macrocall $name=\"keyboard-driven-input\"\n    tiddler=<<__storeTitle__>>\n    type=\"search\"\n    tag=\"input\"\n    focus={{$:/config/xp/aggregation/SearchAutoFocus}}\n    inputCancelActions=<<__cancel-search-actions__>>/>\n<i class='tc-tiny-gap-left'/>\n<$reveal state=<<__storeTitle__>> type=\"nomatch\" text=\"\">\n<$button class=\"tc-btn-invisible\">\n<<cancel-search-actions>>\n<$action-sendmessage $message=\"tm-focus-selector\" $param=\"\"\".$searchClass$ input\"\"\"/>\n{{$:/core/images/close-button}}\n</$button>\n</$reveal>\n</span>\n<$vars userInput={{{ [<__storeTitle__>get[text]] }}}\n    aggrFilter={{{ [<configTiddler>get[text]] }}}\n    resultCount=\"<$count filter=<<aggrFilter>>/>\">\n<$reveal state=<<__storeTitle__>> type=\"nomatch\" text=\"\">\n<span class=\"xp-search-results\"><<lingo System/Matches>></span>\n</$reveal>\n\n<$macrocall\n  $name=\"table-dynamic\"\n  filter=<<aggrFilter>>\n  fields=\"$fields$\"\n  class=\"$class$\"\n  stateTiddler=\"$state$\"\n  emptyMessage=\" \"\n/>\n\n</$vars>\n</$list>\n\\end\n\n\n\\define aggregation-list-thumbnails(width:\"220\",height:\"123\",storeTitle:\"$:/temp/search/aggregation/thumbnails\",searchClass:\"xp-search-aggregation\",tagbar:\"yes\",promptTiddler:\"$:/aggregation/prompt\")\n\\import $:/aggregation/macros/general\n\\whitespace trim\n<$list filter=<<aggr-has-tids>> emptyMessage=\"{{$promptTiddler$}}\" variable=\"ignore\">\n\n<$reveal default=\"$tagbar$\" type=\"nomatch\" text=\"no\">\n<<aggrTagbar>>\n</$reveal>\n\n<span class=\"xp-search $searchClass$\">\nSearch &#32; <<selectSearchScope>> <i class='tc-small-gap-right'/> <$macrocall $name=\"keyboard-driven-input\"\n    tiddler=<<__storeTitle__>>\n    type=\"search\"\n    tag=\"input\"\n    focus={{$:/config/xp/aggregation/SearchAutoFocus}}\n    inputCancelActions=<<__cancel-search-actions__>>/>\n<i class='tc-tiny-gap-left'/>\n<$reveal state=<<__storeTitle__>> type=\"nomatch\" text=\"\">\n<$button class=\"tc-btn-invisible\">\n<<cancel-search-actions>>\n<$action-sendmessage $message=\"tm-focus-selector\" $param=\"\"\".$searchClass$ input\"\"\"/>\n{{$:/core/images/close-button}}\n</$button>\n</$reveal>\n</span>\n<$vars userInput={{{ [<__storeTitle__>get[text]] }}}\n    aggrFilter={{{ [<configTiddler>get[text]] }}}\n    resultCount=\"<$count filter=<<aggrFilter>>/>\">\n<$reveal state=<<__storeTitle__>> type=\"nomatch\" text=\"\">\n<span class=\"xp-search-results\"><<lingo System/Matches>></span>\n</$reveal>\n\n<div style=\"font-size:0.7em;text-align:left;margin-top:2em;margin-bottom:2em;\">\n<$macrocall\n  $name=\"list-thumbnails\"\n  filter=<<aggrFilter>>\n  width=\"$width$\"\n  height=\"$height$\"\n/>\n</div>\n\n</$vars>\n</$list>\n\\end\n\n\n\\define aggregation-list-links(storeTitle:\"$:/temp/search/aggregation/links\",searchClass:\"xp-search-aggregation\",tagbar:\"yes\",promptTiddler:\"$:/aggregation/prompt\")\n\\import $:/aggregation/macros/general\n\\whitespace trim\n<$list filter=<<aggr-has-tids>> emptyMessage=\"{{$promptTiddler$}}\" variable=\"ignore\">\n\n<$reveal default=\"$tagbar$\" type=\"nomatch\" text=\"no\">\n<<aggrTagbar>>\n</$reveal>\n\n<span class=\"xp-search $searchClass$\">\nSearch &#32; <<selectSearchScope>><i class='tc-small-gap-right'/> <$macrocall $name=\"keyboard-driven-input\"\n    tiddler=<<__storeTitle__>>\n    type=\"search\"\n    tag=\"input\"\n    focus={{$:/config/xp/aggregation/SearchAutoFocus}}\n    inputCancelActions=<<__cancel-search-actions__>>/>\n<i class='tc-tiny-gap-left'/>\n<$reveal state=<<__storeTitle__>> type=\"nomatch\" text=\"\">\n<$button class=\"tc-btn-invisible\">\n<<cancel-search-actions>>\n<$action-sendmessage $message=\"tm-focus-selector\" $param=\"\"\".$searchClass$ input\"\"\"/>\n{{$:/core/images/close-button}}\n</$button>\n</$reveal>\n</span>\n<$vars userInput={{{ [<__storeTitle__>get[text]] }}}\n    aggrFilter={{{ [<configTiddler>get[text]] }}}\n    resultCount=\"<$count filter=<<aggrFilter>>/>\">\n<$reveal state=<<__storeTitle__>> type=\"nomatch\" text=\"\">\n<span class=\"xp-search-results\"><<lingo System/Matches>></span>\n</$reveal>\n<$reveal default=<<resultCount>> type=\"nomatch\" text=\"0\">\n<p>{{$:/language/xp/aggregation/ClickPopup}}</p>\n</$reveal>\n\n<div class=\"twocolumns\" style=\"padding:10px 28px;line-height:1.55;\">\n<$list filter=<<aggrFilter>> template=\"$:/templates/popup-caption-view\"/>\n</div>\n\n</$vars>\n</$list>\n\\end\n\n","modified":"20230402014525104"},{"created":"20230402014534059","title":"$:/aggregation/macros/definitions","tags":"$:/tags/Macro/Aggregation $:/tags/XpPreview","text":"\\define lingo-base() $:/language/Search/\n\n\\define toggleViewButton()\n\\whitespace trim\n<$reveal state=<<defaultView>> default=\"table\" type=\"nomatch\" text=\"card\">\n<$button tooltip=\"Switching to card view\" class=\"tc-btn-invisible tc-btn-mini\">\n<$action-setfield $tiddler=<<defaultView>> text=\"card\"/>\n{{$:/xp/images/switch}}\n</$button>\n</$reveal>\n<$reveal state=<<defaultView>> type=\"match\" text=\"card\">\n<$button tooltip=\"Switching to table view\" class=\"tc-btn-invisible tc-btn-mini\">\n<$action-setfield $tiddler=<<defaultView>> text=\"table\"/>\n{{$:/xp/images/switch}}\n</$button>\n</$reveal>\n\\end\n\n\\define sortingButton()\n\\whitespace trim\n<span class=\"tc-popup-keep\">\n<$button popup=<<qualify \"$:/state/xp/aggregation/sorting-button\">> tooltip=\"Sorted by field\" class=\"tc-btn-invisible\">\n{{$:/xp/images/sorting}}\n</$button>\n</span>\n\n<$reveal state=<<qualify \"$:/state/xp/aggregation/sorting-button\">> type=\"popup\" position=\"below\" animate=\"yes\">\n<$vars mainFilter={{{ [<filterTiddler>get[text]] }}} pt1=\"+[sort[\" pt2=\"+[!sort[\" st=\"]]\">\n<$set name=\"tv-show-missing-links\" value=\"yes\">\n<$linkcatcher actions=\"\"\"<$action-setfield $tiddler=<<sortTiddler>> text=<<navigateTo>>/>\n  <$list filter=\"[<navigateTo>prefix<pt1>]\" variable=\"ignore\">\n    <$action-setfield $tiddler=<<tempTableSort>> $index=\"sortIndex\" $value={{{ [<navigateTo>removeprefix<pt1>removesuffix<st>] }}}/>\n    <$action-setfield $tiddler=<<tempTableSort>> $index=\"hasnegate\" $value=\"false\"/>\n    <$action-setfield $tiddler=<<tempTableSort>> $index=\"negate\" $value=\"\"/>\n  </$list>\n  <$list filter=\"[<navigateTo>prefix<pt2>]\" variable=\"ignore\">\n    <$action-setfield $tiddler=<<tempTableSort>> $index=\"sortIndex\" $value={{{ [<navigateTo>removeprefix<pt2>removesuffix<st>] }}}/>\n    <$action-setfield $tiddler=<<tempTableSort>> $index=\"hasnegate\" $value=\"true\"/>\n    <$action-setfield $tiddler=<<tempTableSort>> $index=\"negate\" $value=\"!\"/>\n  </$list>\"\"\">\n<div class=\"tc-block-dropdown-wrapper\">\n<div class=\"tc-block-dropdown tc-edit-type-dropdown xp-sorting-dropdown\">\n  <div class=\"tc-dropdown-item\">Common</div>\n  <$list filter=\"title caption modified modifier created creator\" variable=\"listField\">\n    <$link to={{{ [<listField>addprefix<pt1>addsuffix<st>] }}}><$text text=<<listField>>/></$link>\n    <$link to={{{ [<listField>addprefix<pt2>addsuffix<st>] }}}><$text text={{{ [<listField>addsuffix[↑]] }}}/></$link>\n  </$list>\n  <div class=\"tc-dropdown-item\">Other</div>\n  <$list filter=\"[subfilter<__filter__>] +[fields[]sort[]] -[enlist{$:/config/xp/aggregation/excluded-fields/sorting-button}] -title -caption -modified -modifier -created -creator\" variable=\"listField\" emptyMessage=\"\"\"<p class=\"tc-muted\">&emsp;No fields</p>\"\"\">\n    <$link to={{{ [<listField>addprefix<pt1>addsuffix<st>] }}}><$text text=<<listField>>/></$link>\n    <$link to={{{ [<listField>addprefix<pt2>addsuffix<st>] }}}><$text text={{{ [<listField>addsuffix[↑]] }}}/></$link>\n  </$list>\n</div>\n</div>\n</$linkcatcher>\n</$set>\n</$vars>\n</$reveal>\n\\end\n\n\\define unsortButton()\n\\whitespace trim\n<$vars pt1=\"+[sort[\" pt2=\"+[!sort[\" st=\"]]\" btnClass=\"xp-aggrfilter-dynamic-btn\">\n<$reveal state=<<sortState>> type=\"nomatch\" text=\"\" animate=\"yes\">\n&emsp;\n<$list filter=\"[<sortTiddler>search:text:literal<sortIndex>]\" variable=\"ignore\">\n<$list filter=\"[<sortTiddler>get[text]prefix<pt1>]\" variable=\"ignore\">\n<$button tooltip=\"Descending order\" class=<<btnClass>>>\n<$text text={{{ [<sortTiddler>get[text]removeprefix<pt1>removesuffix<st>] }}}/>&nbsp;&darr;\n<$action-setfield $tiddler=<<tempTableSort>> $index=\"hasnegate\" $value=\"true\"/>\n<$action-setfield $tiddler=<<tempTableSort>> $index=\"negate\" $value=\"!\"/>\n<$action-setfield $tiddler=<<sortTiddler>> text={{{ [<sortTiddler>get[text]search-replace[sort[],[!sort[]] }}}/>\n</$button>\n</$list>\n<$list filter=\"[<sortTiddler>get[text]prefix<pt2>]\" variable=\"ignore\">\n<$button tooltip=\"Ascending order\" class=<<btnClass>>>\n<$text text={{{ [<sortTiddler>get[text]removeprefix<pt2>removesuffix<st>] }}}/>&nbsp;&uarr;\n<$action-setfield $tiddler=<<tempTableSort>> $index=\"hasnegate\" $value=\"false\"/>\n<$action-setfield $tiddler=<<tempTableSort>> $index=\"negate\" $value=\"\"/>\n<$action-setfield $tiddler=<<sortTiddler>> text={{{ [<sortTiddler>get[text]search-replace[!sort[],[sort[]] }}}/>\n</$button>\n</$list>\n</$list>\n<$button class=<<btnClass>>>\nunsort\n<$action-deletetiddler $filter=\"[<sortTiddler>] [<tempTableSort>]\"/>\n</$button>\n</$reveal>\n</$vars>\n\\end\n\n\\define toggleReadingMode()\n\\whitespace trim\n<$reveal state=<<readingMode>> default=\"off\" type=\"nomatch\" text=\"on\">\n<$button tooltip=\"Turn on reading mode\" class=\"tc-btn-invisible tc-btn-mini\">\n<$action-setfield $tiddler=<<readingMode>> text=\"on\"/>\n{{$:/xp/images/readingmode}}\n</$button>\n</$reveal>\n<$reveal state=<<readingMode>> type=\"match\" text=\"on\">\n<$button tooltip=\"Turn off reading mode\" class=\"tc-btn-invisible tc-btn-mini\">\n<$action-deletetiddler $tiddler=<<readingMode>>/>\n{{$:/xp/images/readingmode-on}}\n</$button>\n</$reveal>\n\\end\n\n\\define viewSource()\n\\whitespace trim\n<$reveal state=<<readingMode>> type=\"match\" text=\"on\">\n<$reveal state=<<sourceMode>> default=\"off\" type=\"nomatch\" text=\"on\">\n<$button tooltip=\"Display source code\" class=\"tc-btn-invisible tc-btn-mini\">\n<$action-setfield $tiddler=<<sourceMode>> text=\"on\"/>\n{{$:/xp/images/sourcemode}}\n</$button>\n</$reveal>\n<$reveal state=<<sourceMode>> type=\"match\" text=\"on\">\n<$button tooltip=\"Turn off source mode\" class=\"tc-btn-invisible tc-btn-mini\">\n<$action-deletetiddler $tiddler=<<sourceMode>>/>\n{{$:/xp/images/sourcemode-on}}\n</$button>\n</$reveal>\n</$reveal>\n\\end\n\n\\define tocSwitch()\n\\whitespace trim\n<$reveal state=<<readingMode>> type=\"match\" text=\"on\">\n<$reveal state=<<tocSwitchTid>> default=\"show\" type=\"nomatch\" text=\"hide\">\n<$button tooltip=\"Hide toc\" class=\"tc-btn-invisible tc-btn-mini\">\n<$action-setfield $tiddler=<<tocSwitchTid>> text=\"hide\"/>\n{{$:/core/images/preview-open}}\n</$button>\n</$reveal>\n<$reveal state=<<tocSwitchTid>> type=\"match\" text=\"hide\">\n<$button tooltip=\"Show toc\" class=\"tc-btn-invisible tc-btn-mini\">\n<$action-setfield $tiddler=<<tocSwitchTid>> text=\"show\"/>\n{{$:/core/images/preview-closed}}\n</$button>\n</$reveal>\n</$reveal>\n\\end\n\n\\define target-filter-code(filter)\n<$vars L=\"tag[\" R=\"]\" lb=\" +[\">\n<$set filter=\"[list<filterState>addprefix<L>addsuffix<R>]+[join[]addprefix<lb>addprefix<__filter__>addsuffix<R>addsuffix<searchRun>addsuffix<timeRun>addsuffix<fieldRun>addsuffix<valueRun>addsuffix<sortRun>]\" name=\"target\" select=0>\n<$text text=<<target>>/>\n</$set>\n</$vars>\n\\end\n\n\\define aggrfilteritem(item:\"\")\n<$checkbox tiddler=<<qualify \"\"\"$:/temp/$item$\"\"\">> field=\"status\" checked=\"selected\" checkactions=<<checkactions \"\"\"$item$\"\"\">> uncheckactions=<<uncheckactions \"\"\"$item$\"\"\">> default=\"closed\"> <$text text=<<__item__>>/></$checkbox>\n\\end\n\n\\define checkactions(item:\"\")\n<$action-listops $tiddler=<<filterState>> $subfilter=\"[[$item$]]\"/>\n<$action-listops $tiddler=<<filterState>> $field=\"checktiddler\" $subfilter={{{ [<qualify \"\"\"$:/temp/$item$\"\"\">format:titlelist[]] }}}/>\n<$list filter=\"[list<filterState>!is[tag]]\" variable=\"missingItem\">\n<$action-listops $tiddler=<<filterState>> $subfilter=\"-[<missingItem>]\"/>\n</$list>\n\\end\n\n\\define uncheckactions(item:\"\")\n<$action-listops $tiddler=<<filterState>> $subfilter=\"-[[$item$]]\"/>\n<$list filter=\"[list<filterState>!is[tag]]\" variable=\"missingItem\">\n<$action-listops $tiddler=<<filterState>> $subfilter=\"-[<missingItem>]\"/>\n</$list>\n\\end\n\n\\define deselectButton()\n\\whitespace trim\n<$reveal default={{{ [list<filterState>count[]] }}} type=\"gt\" text=\"1\" animate=\"yes\">\n&emsp;<$button class=\"xp-aggrfilter-dynamic-btn\">\n<$action-deletetiddler $filter=\"[<filterState>get[checktiddler]enlist-input[]]\"/>\n<$action-deletefield $tiddler=<<filterState>> list/>\ndeselect all\n</$button>\n</$reveal>\n\\end\n\n\\define resetFieldButton()\n\\whitespace trim\n<$list filter=\"[<fieldTiddler>has[text]] [<dateTiddler>is[tiddler]] [<filterState>has[filter]] +[limit[1]]\">\n&emsp;<$button class=\"xp-aggrfilter-dynamic-btn\">\n<$action-deletetiddler $filter=\"[<fieldTiddler>] [<dateTiddler>] [<valueTiddler>]\"/>\n<$action-deletefield $tiddler=<<filterState>> filter/>\nreset\n</$button>\n</$list>\n\\end\n\n\\define input-accept-actions-date() <$action-setfield $tiddler=<<filterState>> filter={{{ [<dateTiddler>get[text]addprefix<pt>addsuffix<st>] }}}/>\n\n\\define input-cancel-actions-date() <$action-deletefield $tiddler=<<dateTiddler>> text/>\n\n\\define resetFieldsActions()\n<$action-setfield $tiddler=<<fieldsTiddler>> text=<<__defaultFields__>> list=<<__defaultFields__>>/>\n<$list filter=\"[subfilter<__filter__>] +[fields[]sort[]] -[enlist{$:/config/xp/aggregation/excluded-fields/dtable}] +[format:titlelist[]]\" variable=\"listField\">\n<$action-listops $tiddler=<<fieldsTiddler>> $subfilter=\"+[append<listField>]\"/>\n</$list>\n\\end\n\n\\define updateFieldsActions()\n<$action-setfield $tiddler=<<fieldsTiddler>> list={{{ [<fieldsTiddler>get[text]] }}}/>\n<$list filter=\"[subfilter<__filter__>] +[fields[]sort[]] -[enlist{$:/config/xp/aggregation/excluded-fields/dtable}] +[format:titlelist[]]\" variable=\"listField\">\n<$action-listops $tiddler=<<fieldsTiddler>> $subfilter=\"+[append<listField>]\"/>\n</$list>\n\\end\n\n\\define fields-checkactions()\n<$action-listops $tiddler=<<targetTiddler>> $field=\"text\" $subfilter=\"+[append<currentTiddler>]\"/>\n<<updateFieldsActions>>\n\\end\n\n\\define fields-uncheckactions()\n<$action-listops $tiddler=<<targetTiddler>> $field=\"text\" $subfilter=\"-[<currentTiddler>]\"/>\n<<updateFieldsActions>>\n\\end\n\n\\define tableFieldsButton()\n\\whitespace trim\n<$reveal state=<<fieldsState>> default=\"no\" type=\"nomatch\" text=\"yes\">\n<$button tooltip=\"Select dynamic table fields\" class=\"tc-btn-invisible tc-btn-mini\">\n<$action-setfield $tiddler=<<fieldsState>> text=\"yes\"/>\n<!-- 1st run: initialize data -->\n<$reveal state=<<fieldsTiddler>> type=\"match\" text=\"\">\n<<resetFieldsActions>>\n<$list filter=<<__defaultFields__>> variable=\"listField\">\n<$action-setfield $tiddler=<<field-config-title>> text=\"show\"/>\n</$list>\n</$reveal>\n<!-- Subsequent runs -->\n<$reveal state=<<fieldsTiddler>> type=\"nomatch\" text=\"\">\n<$reveal\n  default={{{ [subfilter<__filter__>] +[fields[]] -[enlist<__defaultFields__>] -[enlist{$:/config/xp/aggregation/excluded-fields/dtable}] +[count[]] }}}\n  type=\"nomatch\"\n  text={{{ [list<fieldsTiddler>] -[enlist<__defaultFields__>] +[count[]] }}}>\n<<updateFieldsActions>>\n</$reveal></$reveal>\n{{$:/xp/images/dtable}}\n</$button>\n</$reveal>\n<$reveal state=<<fieldsState>> type=\"match\" text=\"yes\">\n<$button tooltip=\"Close selection panel\" class=\"tc-btn-invisible tc-btn-mini\">\n<$action-setfield $tiddler=<<fieldsState>> text=\"no\"/>\n{{$:/xp/images/dtable-panel}}\n</$button>\n</$reveal>\n\\end\n\n\\define resetFieldsButton()\n\\whitespace trim\n<$wikify name=\"defaultFieldsCount\" text=\"<$count filter='[enlist<__defaultFields__>]'/>\">\n<$vars\n  comparingFields={{{ [enlist<__defaultFields__>] :filter[lookup<config-base>match[show]] +[count[]!match<defaultFieldsCount>] +[then[reset]] }}}\n  otherFields={{{ [subfilter<__filter__>] +[fields[]] -[enlist<__defaultFields__>] :filter[lookup<config-base>match[show]] +[then[reset]] }}}>\n<$list filter=\"[<comparingFields>] [<otherFields>] +[match[reset]limit[1]]\" variable=\"ignore\">\n&emsp;<$button class=\"xp-aggrfilter-dynamic-btn\">\n<!-- Delete config tiddlers -->\n<$action-deletetiddler $filter=\"[regexp[TableFields/Visibility]prefix[$:/config/]prefix<fieldsTiddler>prefix<config-base>]\"/>\n<$list filter=\"[enlist<__defaultFields__>]\" variable=\"listField\">\n<$action-setfield $tiddler=<<field-config-title>> text=\"show\"/>\n</$list>\n<!-- Reset fields -->\n<<resetFieldsActions>>\nreset\n</$button>\n</$list>\n</$vars>\n</$wikify>\n\\end\n\n\\define updateFieldsButton()\n\\whitespace trim\n<$reveal\n  default={{{ [subfilter<__filter__>] +[fields[]] -[enlist<__defaultFields__>] -[enlist{$:/config/xp/aggregation/excluded-fields/dtable}] +[count[]] }}}\n  type=\"nomatch\"\n  text={{{ [list<fieldsTiddler>] -[enlist<__defaultFields__>] +[count[]] }}}>\n&nbsp;<$button class=\"xp-aggrfilter-dynamic-btn\">\n<<updateFieldsActions>>\nupdate\n</$button>\n</$reveal>\n\\end\n\n\\define aggregation-fields-draggable-config-title()\n$(config-base)$$(currentTiddler)$\n\\end\n\n\\define aggregation-fields-draggable-drop-actions()\n<$action-listops $tiddler=<<targetTiddler>> $field=<<targetField>> $subfilter=\"+[insertbefore<actionTiddler>,<currentTiddler>]\"/>\n<$reveal state=<<aggregation-fields-draggable-config-title>> type=\"match\" text=\"show\">\n<$action-listops $tiddler=<<targetTiddler>> $field=\"text\" $subfilter=\"+[insertbefore<actionTiddler>,<currentTiddler>]\"/>\n</$reveal>\n\\end\n\n\\define aggregation-fields-draggable(tiddler,field:\"list\",exclude,emptyMessage,itemTemplate,elementTag:\"div\",storyview:\"\")\n\\whitespace trim\n<$vars targetTiddler=\"\"\"$tiddler$\"\"\" targetField=\"\"\"$field$\"\"\">\n<$list filter=\"[list[$tiddler$!!$field$]] -[enlist<__exclude__>]\" emptyMessage=<<__emptyMessage__>> storyview=<<__storyview__>>>\n<$droppable actions=<<aggregation-fields-draggable-drop-actions>> enable=<<tv-enable-drag-and-drop>>>\n<$elementTag$ class=\"tc-droppable-placeholder\"/>\n<$elementTag$>\n<$transclude tiddler=\"\"\"$itemTemplate$\"\"\">\n<$link to={{!!title}}>\n<$view field=\"title\"/>\n</$link>\n</$transclude>\n</$elementTag$>\n</$droppable>\n</$list>\n<$tiddler tiddler=\"\">\n<$droppable actions=<<aggregation-fields-draggable-drop-actions>> tag=\"div\" enable=<<tv-enable-drag-and-drop>>>\n<$elementTag$ class=\"tc-droppable-placeholder\"/>\n<$elementTag$ style=\"height:0.5em;\">\n</$elementTag$>\n</$droppable>\n</$tiddler>\n</$vars>\n\\end\n\n\\define aggregation-dtable-controls()\n\\whitespace trim\n<<toggle-edit-view-trim>>\n<span class=\"xp-controls\" style=\"padding-left:.25em;\">\n<<tableFieldsButton>>\n<$list filter=\"[<__paginationButton__>match[yes]]\" variable=ignore>\n<<toggle-pagination>>\n</$list>\n<$list filter=\"[<__rowsButton__>match[yes]]\" variable=ignore>\n<<footer-rows-button>>\n</$list>\n</span>\n\\end\n\n\\define aggregation-dtable(filter, fields:\"tbl-expand title\", indexes:\"\", sortOp:\"sort\", caption:\"\", class:\"w-100\", stateTiddler:\"aggregation-state\", editButton:\"yes\", paginationButton:\"yes\", rowsButton:\"no\", emptyMessage)\n\\import [[$:/tags/Table/Macro]tagging[]]\n<!--above commands import utility macros-->\n<$let\n  fieldsTiddler=\"\"\"$:/config/xp/$stateTiddler$/TableFields\"\"\"\n  fieldsState=\"\"\"$:/state/xp/$stateTiddler$/ModifyTableFields\"\"\"\n  pageTiddler=\"\"\"$:/config/xp/$stateTiddler$/Pagination\"\"\"\n  rowsTiddler=\"\"\"$:/config/xp/$stateTiddler$/FooterRows\"\"\"\n  rowsState=\"\"\"$:/state/xp/$stateTiddler$/FooterRows\"\"\"\n  footerTiddler=\"\"\"$:/keepstate/dynamictables/$stateTiddler$/footer\"\"\"\n\n  inputFilter=\"[subfilter<__filter__>!has[draft.of]]\"\n  sortType=<<__sortOp__>>\n  pagination={{{ [<pageTiddler>is[tiddler]get[text]] ~no }}}\n  footerRows={{{ [<rowsTiddler>is[tiddler]get[text]] ~0 }}}\n  >\n<$set name=currentTable value=<<__stateTiddler__>> emptyValue=<<currentTiddler>> >\n<$reveal state=<<fieldsState>> type=\"match\" text=\"yes\" animate=\"yes\">\n<div class=\"xp-wrapper-aggrfilter\">\n\n<div style=\"position:relative;\">\n<div class=\"tc-tiddler-controls\" style=\"position:absolute;right:0;\">\n<$button set=<<fieldsState>> setTo=\"\" tooltip=\"Close panel\" aria-label=\"select table fields\" class=\"tc-btn-invisible\">\n{{$:/core/images/close-button}}\n</$button>\n</div>\n</div>\n\n<span class=\"tc-muted\">Dynamic table Fields:</span> <<resetFieldsButton>><<updateFieldsButton>>\n\n<div class=\"xp-aggrfilter-category\">\n<div class=\"xp-aggrfilter-category-item\">\n<$macrocall\n  $name=\"aggregation-fields-draggable\"\n  tiddler=<<fieldsTiddler>>\n  itemTemplate=\"$:/aggregation/fields-smart-mode/ItemTemplate\"\n  exclude={{$:/config/xp/aggregation/excluded-fields/dtable}}\n/>\n</div>\n</div>\n\n</div>\n</$reveal>\n<!-- check what type of columns are sent, fileds or indexes (data tiddlers as records) -->\n<$set name=fieldOrIndex filter=\"[<__fields__>!is[blank]]\" value=\"field\" emptyValue=\"index\">\n<<check_tiddlers_type_for_table_from_indexes isEditable:\"$editButton$\">>\n<$set name=columns filter=\"[<fieldOrIndex>]-index\" value=<<__fields__>> emptyValue=<<__indexes__>> >\n<!--check input filter parameter-->\n<$list filter=\"[subfilter<inputFilter>limit[1]]\" emptyMessage=<<__emptyMessage__>> variable=ignore>\n<$set name=sortneg tiddler=<<tempTableSort>> index=\"negate\">\n<!--calculate the number of columns in edit and view mode -->\n<$set name=ncols filter=\"[<tempTableEdit>getindex[mode]match[edit]]\" value={{{ [subfilter<columnFilter>count[]] }}} emptyValue={{{ [subfilter<columnFilter>count[]subtract[1]] }}}>\n<div class=\"tbl-container\" style=\"max-width:100%;\">\n<table class=<<__class__>> style=\"caption-side:top\">\n<!-- reveal caption and edit button -------------------->\n<caption style=\"text-align:left;\">\n<$list filter=\"[<__editButton__>match[yes]]\" variable=ignore>\n<span style=\"padding-right:5px;padding-left:3px;\">\n<<aggregation-dtable-controls>>\n<<select-footer-rows>>\n</span>\n</$list>\n<$reveal state=<<rowsState>> type=\"nomatch\" text=\"yes\" animate=\"yes\">\n$caption$\n</$reveal></caption>\n\n<!-- create header -------------------->\n<thead>\n<<confirm-delete>>\n<tr>\n<$list filter=<<columnFilter>> variable=currentColumn>\n<$set name=\"headerLookup\" filter=\"[all[tiddlers+shadows]tag[$:/tags/Table/HeaderTemplate]contains:tbl-column-list<currentColumn>limit[1]get[title]]\" value=<<headerLookup>> emptyValue=\"$:/plugins/kookma/shiraz/templates/header/default\">\n <$transclude tiddler=<<headerLookup>> field=\"text\" mode=\"inline\"/>\n</$set>\n</$list>\n</tr>\n</thead>\n\n<!-- create footer -------------------->\n<$reveal type=\"gt\" default=<<footerRows>> text=\"0\" tag=\"tfoot\" class=\"shiraz-dtable-footer\">\n<tr><td colspan=<<ncols>> style=\"font-weight:bold;background-color:transparent;\">Numerical summary</td></tr>\n<$list filter=\"[range<footerRows>addprefix[footer-]]\" variable=footerRow>\n<tr>\n<$list filter=<<columnFilter>> variable=currentColumn>\n<$set name=\"footerLookup\" filter=\"[all[tiddlers+shadows]tag[$:/tags/Table/FooterTemplate]contains:tbl-column-list<currentColumn>limit[1]get[title]]\" value=<<footerLookup>> emptyValue=\"$:/plugins/kookma/shiraz/templates/footer/default\">\n<$transclude tiddler=<<footerLookup>> field=\"text\" mode=\"inline\"/>\n</$set>\n</$list>\n</tr>\n</$list>\n</$reveal>\n\n<!-- reveal main body of table (generate records) -------------------->\n<tbody>\n<$set name=tableBody filter=\"[<fieldOrIndex>]-index\" value=\"display_body_fields\" emptyValue=\"display_body_indexes\" >\n<!-- setup pagination variables -->\n<$vars total-entries={{{[subfilter<inputFilter>count[]] }}}\n\t\t\t page-number={{{[<pageStateTiddler>get[text]] ~[[1]]}}} \n\t\t\t entries-per-page={{{ [<entryPerPageStateTiddler>get[text]] ~[[25]]   }}}  >\n<$vars low={{{ [<page-number>subtract[1]multiply<entries-per-page>] }}}  \n       high={{{[<page-number>multiply<entries-per-page>]            }}} >\t \n<$macrocall $name=<<tableBody>> />\n<!--on demand display the pagination row-->\n<$reveal type=\"match\" default=<<pagination>> text=\"yes\" tag=\"tr\" class=\"shiraz-dtable-page-footer\">\n<td colspan=<<ncols>> >\n<<prev-button>>\nDisplaying <$text text={{{[<low>add[1]]}}}/> through <$text text={{{ [<high>compare:number:lt<total-entries>then<high>else<total-entries>] }}}/> of <<total-entries>> Results | <<limit-entries>>\n<<next-button>>\n</td>\n</$reveal><!-- end of pagination ui -->\n</$vars>\n</$vars>\n</$set>\n</tbody>\n</table>\n</div><!-- container-->\n</$set>\n</$set>\n</$list><!--check input filter parameter-->\n</$set>\n</$set>\n</$set>\n</$let>\n\\end\n\n\n<pre><$view field=\"text\"/></pre>","modified":"20230402014534059"},{"created":"20230402014552240","title":"$:/aggregation/fields-smart-mode/ItemTemplate","text":"<$draggable tiddler=<<currentTiddler>>>\n<$checkbox tiddler=<<aggregation-fields-draggable-config-title>> field=\"text\" checked=\"show\" unchecked=\"hide\" default=\"hide\" checkactions=<<fields-checkactions>> uncheckactions=<<fields-uncheckactions>>/> <span class=\"tc-icon-wrapper\"> <$transclude field=\"title\"/></span>\n</$draggable>","tags":"$:/tags/XpPreview","modified":"20230402014552240"}]